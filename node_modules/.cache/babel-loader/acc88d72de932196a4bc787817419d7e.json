{"ast":null,"code":"/**\n * Module dependencies.\n */\nvar EventEmitter = require('events').EventEmitter;\n\nvar parser = require('engine.io-parser');\n\nvar util = require('util');\n\nvar debug = require('debug')('engine:transport');\n/**\n * Expose the constructor.\n */\n\n\nmodule.exports = Transport;\n/**\n * Noop function.\n *\n * @api private\n */\n\nfunction noop() {}\n/**\n * Transport constructor.\n *\n * @param {http.IncomingMessage} request\n * @api public\n */\n\n\nfunction Transport(req) {\n  this.readyState = 'open';\n  this.discarded = false;\n}\n/**\n * Inherits from EventEmitter.\n */\n\n\nutil.inherits(Transport, EventEmitter);\n/**\n * Flags the transport as discarded.\n *\n * @api private\n */\n\nTransport.prototype.discard = function () {\n  this.discarded = true;\n};\n/**\n * Called with an incoming HTTP request.\n *\n * @param {http.IncomingMessage} request\n * @api private\n */\n\n\nTransport.prototype.onRequest = function (req) {\n  debug('setting request');\n  this.req = req;\n};\n/**\n * Closes the transport.\n *\n * @api private\n */\n\n\nTransport.prototype.close = function (fn) {\n  if ('closed' === this.readyState || 'closing' === this.readyState) return;\n  this.readyState = 'closing';\n  this.doClose(fn || noop);\n};\n/**\n * Called with a transport error.\n *\n * @param {String} message error\n * @param {Object} error description\n * @api private\n */\n\n\nTransport.prototype.onError = function (msg, desc) {\n  if (this.listeners('error').length) {\n    var err = new Error(msg);\n    err.type = 'TransportError';\n    err.description = desc;\n    this.emit('error', err);\n  } else {\n    debug('ignored transport error %s (%s)', msg, desc);\n  }\n};\n/**\n * Called with parsed out a packets from the data stream.\n *\n * @param {Object} packet\n * @api private\n */\n\n\nTransport.prototype.onPacket = function (packet) {\n  this.emit('packet', packet);\n};\n/**\n * Called with the encoded packet data.\n *\n * @param {String} data\n * @api private\n */\n\n\nTransport.prototype.onData = function (data) {\n  this.onPacket(parser.decodePacket(data));\n};\n/**\n * Called upon transport close.\n *\n * @api private\n */\n\n\nTransport.prototype.onClose = function () {\n  this.readyState = 'closed';\n  this.emit('close');\n};","map":{"version":3,"names":["EventEmitter","require","parser","util","debug","module","exports","Transport","noop","req","readyState","discarded","inherits","prototype","discard","onRequest","close","fn","doClose","onError","msg","desc","listeners","length","err","Error","type","description","emit","onPacket","packet","onData","data","decodePacket","onClose"],"sources":["/Users/johnberetty/node_modules/engine.io/lib/transport.js"],"sourcesContent":["\n/**\n * Module dependencies.\n */\n\nvar EventEmitter = require('events').EventEmitter;\nvar parser = require('engine.io-parser');\nvar util = require('util');\nvar debug = require('debug')('engine:transport');\n\n/**\n * Expose the constructor.\n */\n\nmodule.exports = Transport;\n\n/**\n * Noop function.\n *\n * @api private\n */\n\nfunction noop () {}\n\n/**\n * Transport constructor.\n *\n * @param {http.IncomingMessage} request\n * @api public\n */\n\nfunction Transport (req) {\n  this.readyState = 'open';\n  this.discarded = false;\n}\n\n/**\n * Inherits from EventEmitter.\n */\n\nutil.inherits(Transport, EventEmitter);\n\n/**\n * Flags the transport as discarded.\n *\n * @api private\n */\n\nTransport.prototype.discard = function () {\n  this.discarded = true;\n};\n\n/**\n * Called with an incoming HTTP request.\n *\n * @param {http.IncomingMessage} request\n * @api private\n */\n\nTransport.prototype.onRequest = function (req) {\n  debug('setting request');\n  this.req = req;\n};\n\n/**\n * Closes the transport.\n *\n * @api private\n */\n\nTransport.prototype.close = function (fn) {\n  if ('closed' === this.readyState || 'closing' === this.readyState) return;\n\n  this.readyState = 'closing';\n  this.doClose(fn || noop);\n};\n\n/**\n * Called with a transport error.\n *\n * @param {String} message error\n * @param {Object} error description\n * @api private\n */\n\nTransport.prototype.onError = function (msg, desc) {\n  if (this.listeners('error').length) {\n    var err = new Error(msg);\n    err.type = 'TransportError';\n    err.description = desc;\n    this.emit('error', err);\n  } else {\n    debug('ignored transport error %s (%s)', msg, desc);\n  }\n};\n\n/**\n * Called with parsed out a packets from the data stream.\n *\n * @param {Object} packet\n * @api private\n */\n\nTransport.prototype.onPacket = function (packet) {\n  this.emit('packet', packet);\n};\n\n/**\n * Called with the encoded packet data.\n *\n * @param {String} data\n * @api private\n */\n\nTransport.prototype.onData = function (data) {\n  this.onPacket(parser.decodePacket(data));\n};\n\n/**\n * Called upon transport close.\n *\n * @api private\n */\n\nTransport.prototype.onClose = function () {\n  this.readyState = 'closed';\n  this.emit('close');\n};\n"],"mappings":"AACA;AACA;AACA;AAEA,IAAIA,YAAY,GAAGC,OAAO,CAAC,QAAD,CAAP,CAAkBD,YAArC;;AACA,IAAIE,MAAM,GAAGD,OAAO,CAAC,kBAAD,CAApB;;AACA,IAAIE,IAAI,GAAGF,OAAO,CAAC,MAAD,CAAlB;;AACA,IAAIG,KAAK,GAAGH,OAAO,CAAC,OAAD,CAAP,CAAiB,kBAAjB,CAAZ;AAEA;AACA;AACA;;;AAEAI,MAAM,CAACC,OAAP,GAAiBC,SAAjB;AAEA;AACA;AACA;AACA;AACA;;AAEA,SAASC,IAAT,GAAiB,CAAE;AAEnB;AACA;AACA;AACA;AACA;AACA;;;AAEA,SAASD,SAAT,CAAoBE,GAApB,EAAyB;EACvB,KAAKC,UAAL,GAAkB,MAAlB;EACA,KAAKC,SAAL,GAAiB,KAAjB;AACD;AAED;AACA;AACA;;;AAEAR,IAAI,CAACS,QAAL,CAAcL,SAAd,EAAyBP,YAAzB;AAEA;AACA;AACA;AACA;AACA;;AAEAO,SAAS,CAACM,SAAV,CAAoBC,OAApB,GAA8B,YAAY;EACxC,KAAKH,SAAL,GAAiB,IAAjB;AACD,CAFD;AAIA;AACA;AACA;AACA;AACA;AACA;;;AAEAJ,SAAS,CAACM,SAAV,CAAoBE,SAApB,GAAgC,UAAUN,GAAV,EAAe;EAC7CL,KAAK,CAAC,iBAAD,CAAL;EACA,KAAKK,GAAL,GAAWA,GAAX;AACD,CAHD;AAKA;AACA;AACA;AACA;AACA;;;AAEAF,SAAS,CAACM,SAAV,CAAoBG,KAApB,GAA4B,UAAUC,EAAV,EAAc;EACxC,IAAI,aAAa,KAAKP,UAAlB,IAAgC,cAAc,KAAKA,UAAvD,EAAmE;EAEnE,KAAKA,UAAL,GAAkB,SAAlB;EACA,KAAKQ,OAAL,CAAaD,EAAE,IAAIT,IAAnB;AACD,CALD;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEAD,SAAS,CAACM,SAAV,CAAoBM,OAApB,GAA8B,UAAUC,GAAV,EAAeC,IAAf,EAAqB;EACjD,IAAI,KAAKC,SAAL,CAAe,OAAf,EAAwBC,MAA5B,EAAoC;IAClC,IAAIC,GAAG,GAAG,IAAIC,KAAJ,CAAUL,GAAV,CAAV;IACAI,GAAG,CAACE,IAAJ,GAAW,gBAAX;IACAF,GAAG,CAACG,WAAJ,GAAkBN,IAAlB;IACA,KAAKO,IAAL,CAAU,OAAV,EAAmBJ,GAAnB;EACD,CALD,MAKO;IACLpB,KAAK,CAAC,iCAAD,EAAoCgB,GAApC,EAAyCC,IAAzC,CAAL;EACD;AACF,CATD;AAWA;AACA;AACA;AACA;AACA;AACA;;;AAEAd,SAAS,CAACM,SAAV,CAAoBgB,QAApB,GAA+B,UAAUC,MAAV,EAAkB;EAC/C,KAAKF,IAAL,CAAU,QAAV,EAAoBE,MAApB;AACD,CAFD;AAIA;AACA;AACA;AACA;AACA;AACA;;;AAEAvB,SAAS,CAACM,SAAV,CAAoBkB,MAApB,GAA6B,UAAUC,IAAV,EAAgB;EAC3C,KAAKH,QAAL,CAAc3B,MAAM,CAAC+B,YAAP,CAAoBD,IAApB,CAAd;AACD,CAFD;AAIA;AACA;AACA;AACA;AACA;;;AAEAzB,SAAS,CAACM,SAAV,CAAoBqB,OAApB,GAA8B,YAAY;EACxC,KAAKxB,UAAL,GAAkB,QAAlB;EACA,KAAKkB,IAAL,CAAU,OAAV;AACD,CAHD"},"metadata":{},"sourceType":"script"}