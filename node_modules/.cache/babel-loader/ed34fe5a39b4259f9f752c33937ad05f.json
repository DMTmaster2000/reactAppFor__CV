{"ast":null,"code":"var serverUtils = require(\"./utils.js\");\n\nvar resolve = require(\"path\").resolve;\n\nvar utils = require(\"../utils.js\");\n\nvar serveStatic = require(\"./serve-static-wrapper\").default();\n\nvar serveIndex = require(\"serve-index\");\n/**\n * @param {BrowserSync} bs\n * @returns {*}\n */\n\n\nmodule.exports = function createServer(bs) {\n  var options = bs.options;\n  var server = options.get(\"server\");\n  var basedirs = utils.arrayify(server.get(\"baseDir\"));\n  var serveStaticOptions = server.get(\"serveStaticOptions\").toJS(); // passed to 3rd party\n\n  var _serveStatic = 0;\n  var _routes = 0;\n  bs.options = bs.options\n  /**\n   * Add directory Middleware if given in server.directory\n   */\n  .update(\"middleware\", function (mw) {\n    if (!server.get(\"directory\")) {\n      return mw;\n    }\n\n    return mw.concat({\n      route: \"\",\n      handle: serveIndex(resolve(basedirs[0]), {\n        icons: true,\n        view: \"details\"\n      }),\n      id: \"Browsersync Server Directory Middleware\"\n    });\n  })\n  /**\n   * Add middleware for server.baseDir Option\n   */\n  .update(\"middleware\", function (mw) {\n    return mw.concat(basedirs.map(function (root) {\n      return {\n        route: \"\",\n        id: \"Browsersync Server ServeStatic Middleware - \" + _serveStatic++,\n        handle: serveStatic(resolve(root), serveStaticOptions)\n      };\n    }));\n  })\n  /**\n   * Add middleware for server.routes\n   */\n  .update(\"middleware\", function (mw) {\n    if (!server.get(\"routes\")) {\n      return mw;\n    }\n\n    return mw.concat(server.get(\"routes\").map(function (root, urlPath) {\n      // strip trailing slash\n      if (urlPath[urlPath.length - 1] === \"/\") {\n        urlPath = urlPath.slice(0, -1);\n      }\n\n      return {\n        route: urlPath,\n        id: \"Browsersync Server Routes Middleware - \" + _routes++,\n        handle: serveStatic(resolve(root))\n      };\n    }));\n  });\n  var app = serverUtils.getBaseApp(bs);\n  /**\n   * Finally, return the server + App\n   */\n\n  return serverUtils.getServer(app, bs.options);\n};","map":{"version":3,"mappings":"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","names":["serverUtils","require","resolve","utils","serveStatic","default","serveIndex","module","exports","createServer","bs","options","server","get","basedirs","arrayify","serveStaticOptions","toJS","_serveStatic","_routes","update","mw","concat","route","handle","icons","view","id","map","root","urlPath","length","slice","app","getBaseApp","getServer"],"sources":["../../lib/server/static-server.js"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}