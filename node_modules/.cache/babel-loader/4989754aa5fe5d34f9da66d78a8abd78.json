{"ast":null,"code":"var utils = require(\"./utils\");\n/**\n * Apply the operators that apply to the 'file:changed' event\n * @param {Rx.Observable} subject\n * @param options\n * @return {Rx.Observable<{type: string, files: Array<any>}>}\n */\n\n\nfunction fileChanges(subject, options) {\n  var operators = [{\n    option: \"reloadThrottle\",\n    fnName: \"throttle\"\n  }, {\n    option: \"reloadDelay\",\n    fnName: \"delay\"\n  }];\n  var scheduler = options.getIn([\"debug\", \"scheduler\"]);\n  /**\n   * Create a stream buffered/debounced stream of events\n   */\n\n  var initial = getAggregatedDebouncedStream(subject, options, scheduler);\n  return applyOperators(operators, initial, options, scheduler).map(function (items) {\n    var paths = items.map(function (x) {\n      return x.path;\n    });\n\n    if (utils.willCauseReload(paths, options.get(\"injectFileTypes\").toJS())) {\n      return {\n        type: \"reload\",\n        files: items\n      };\n    }\n\n    return {\n      type: \"inject\",\n      files: items\n    };\n  });\n}\n\nmodule.exports.fileChanges = fileChanges;\n/**\n * Apply the operators that apply to the 'browser:reload' event\n * @param {Rx.Observable} subject\n * @param options\n * @returns {Rx.Observable}\n */\n\nfunction applyReloadOperators(subject, options) {\n  var operators = [{\n    option: \"reloadDebounce\",\n    fnName: \"debounce\"\n  }, {\n    option: \"reloadThrottle\",\n    fnName: \"throttle\"\n  }, {\n    option: \"reloadDelay\",\n    fnName: \"delay\"\n  }];\n  return applyOperators(operators, subject, options, options.getIn([\"debug\", \"scheduler\"]));\n}\n\nmodule.exports.applyReloadOperators = applyReloadOperators;\n/**\n * @param items\n * @param subject\n * @param options\n * @param scheduler\n */\n\nfunction applyOperators(items, subject, options, scheduler) {\n  return items.reduce(function (subject, item) {\n    var value = options.get(item.option);\n\n    if (value > 0) {\n      return subject[item.fnName].call(subject, value, scheduler);\n    }\n\n    return subject;\n  }, subject);\n}\n/**\n * @param subject\n * @param options\n * @param scheduler\n */\n\n\nfunction getAggregatedDebouncedStream(subject, options, scheduler) {\n  return subject.filter(function (x) {\n    return options.get(\"watchEvents\").indexOf(x.event) > -1;\n  }).buffer(subject.debounce(options.get(\"reloadDebounce\"), scheduler));\n}","map":{"version":3,"mappings":"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","names":["utils","require","fileChanges","subject","options","operators","option","fnName","scheduler","getIn","initial","getAggregatedDebouncedStream","applyOperators","map","items","paths","path","willCauseReload","get","toJS","type","files","module","exports","applyReloadOperators","reduce","item","value","call","filter","x","indexOf","event","buffer","debounce"],"sources":["../lib/file-event-handler.js"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}