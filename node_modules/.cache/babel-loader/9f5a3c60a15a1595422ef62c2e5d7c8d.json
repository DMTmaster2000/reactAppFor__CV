{"ast":null,"code":"import _regeneratorRuntime from\"/Users/johnberetty/Desktop/gitHub/my-app-gitHub/my-app/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _toConsumableArray from\"/Users/johnberetty/Desktop/gitHub/my-app-gitHub/my-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"/Users/johnberetty/Desktop/gitHub/my-app-gitHub/my-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/johnberetty/Desktop/gitHub/my-app-gitHub/my-app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useMemo,useEffect}from'react';import PostFilter from'../components/PostFilter';import PostForm from'../components/PostForm';import PostList from'../components/PostList';import MyButton from'../components/UI/button/MyButton';import MyModal from'../components/UI/MyModal/MyModal';import{usePosts}from'../hooks/usePosts';import'../styles/App.css';import PostService from'../API/PostService';import Loader from'../components/UI/loader/Loader';import{useFetching}from'../hooks/useFetching';import{getPageCount,getPagesArray}from'../components/utils/pages';import Pagination from'../components/UI/pagination/Pagination';import{useRef}from'react';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Post(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),posts=_useState2[0],setPosts=_useState2[1];var _useState3=useState({sort:'',query:''}),_useState4=_slicedToArray(_useState3,2),filter=_useState4[0],setFilter=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),modal=_useState6[0],setModal=_useState6[1];var sortedAndSearchedPosts=usePosts(posts,filter.sort,filter.query);var _useState7=useState(0),_useState8=_slicedToArray(_useState7,2),totalPages=_useState8[0],setTotalPages=_useState8[1];var _useState9=useState(10),_useState10=_slicedToArray(_useState9,1),limit=_useState10[0];var _useState11=useState(1),_useState12=_slicedToArray(_useState11,2),page=_useState12[0],setPage=_useState12[1];var lastElement=useRef();var observer=useRef();var _useFetching=useFetching(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var response,totalCount;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return PostService.getAll(limit,page);case 2:response=_context.sent;setPosts([].concat(_toConsumableArray(posts),_toConsumableArray(response.data)));totalCount=response.headers['x-total-count'];setTotalPages(getPageCount(totalCount,limit));case 6:case\"end\":return _context.stop();}}},_callee);}))),_useFetching2=_slicedToArray(_useFetching,2),fetchPosts=_useFetching2[0],isPostLoading=_useFetching2[1];useEffect(function(){if(isPostLoading)return;if(observer.current)observer.current.disconnect();var callback=function callback(entries,observer){if(entries[0].isIntersecting&&page<totalPages){console.log(page);setPage(page+1);}};observer.current=new IntersectionObserver(callback);//console.log(observer.current);\nobserver.current.observe(lastElement.current);},[isPostLoading]);useEffect(function(){fetchPosts(limit,page);},[page]);var createPost=function createPost(newPost){setPosts([].concat(_toConsumableArray(posts),[newPost]));setModal(false);};var removePost=function removePost(post){setPosts(posts.filter(function(p){return p.id!==post.id;}));};var changePage=function changePage(page){setPage(page);};return/*#__PURE__*/_jsxs(\"div\",{className:\"App\",children:[/*#__PURE__*/_jsx(MyButton,{style:{marginTop:30},onClick:function onClick(){return setModal(true);},children:\"Create User\"}),/*#__PURE__*/_jsx(MyModal,{visible:modal,setVisible:setModal,children:/*#__PURE__*/_jsx(PostForm,{create:createPost})}),/*#__PURE__*/_jsx(PostFilter,{filter:filter,setFilter:setFilter}),/*#__PURE__*/_jsx(PostList,{remove:removePost,posts:sortedAndSearchedPosts,title:\"title\"}),/*#__PURE__*/_jsx(\"div\",{ref:lastElement,style:{height:30}}),isPostLoading&&/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'center',marginTop:50},children:[' ',/*#__PURE__*/_jsx(Loader,{})]})]});}export default Post;","map":{"version":3,"names":["React","useState","useMemo","useEffect","PostFilter","PostForm","PostList","MyButton","MyModal","usePosts","PostService","Loader","useFetching","getPageCount","getPagesArray","Pagination","useRef","Post","posts","setPosts","sort","query","filter","setFilter","modal","setModal","sortedAndSearchedPosts","totalPages","setTotalPages","limit","page","setPage","lastElement","observer","getAll","response","data","totalCount","headers","fetchPosts","isPostLoading","current","disconnect","callback","entries","isIntersecting","console","log","IntersectionObserver","observe","createPost","newPost","removePost","post","p","id","changePage","marginTop","height","display","justifyContent"],"sources":["/Users/johnberetty/Desktop/gitHub/my-app-gitHub/my-app/src/pages/Post.jsx"],"sourcesContent":["import React, { useState, useMemo, useEffect } from 'react';\nimport PostFilter from '../components/PostFilter';\nimport PostForm from '../components/PostForm';\nimport PostList from '../components/PostList';\nimport MyButton from '../components/UI/button/MyButton';\nimport MyModal from '../components/UI/MyModal/MyModal';\nimport { usePosts } from '../hooks/usePosts';\nimport '../styles/App.css';\nimport PostService from '../API/PostService';\nimport Loader from '../components/UI/loader/Loader';\nimport { useFetching } from '../hooks/useFetching';\nimport { getPageCount, getPagesArray } from '../components/utils/pages';\nimport Pagination from '../components/UI/pagination/Pagination';\nimport { useRef } from 'react';\n\nfunction Post() {\n  const [posts, setPosts] = useState([]);\n  const [filter, setFilter] = useState({ sort: '', query: '' });\n  const [modal, setModal] = useState(false);\n  const sortedAndSearchedPosts = usePosts(posts, filter.sort, filter.query);\n  const [totalPages, setTotalPages] = useState(0);\n  const [limit] = useState(10);\n  const [page, setPage] = useState(1);\n  const lastElement = useRef();\n  const observer = useRef();\n\n  const [fetchPosts, isPostLoading] = useFetching(async () => {\n    const response = await PostService.getAll(limit, page);\n    setPosts([...posts, ...response.data]);\n    const totalCount = response.headers['x-total-count'];\n    setTotalPages(getPageCount(totalCount, limit));\n  });\n\n  useEffect(() => {\n    if (isPostLoading) return;\n    if (observer.current) observer.current.disconnect();\n    var callback = function (entries, observer) {\n      if (entries[0].isIntersecting && page < totalPages) {\n        console.log(page);\n        setPage(page + 1);\n      }\n    };\n    observer.current = new IntersectionObserver(callback);\n    //console.log(observer.current);\n    observer.current.observe(lastElement.current);\n  }, [isPostLoading]);\n\n  useEffect(() => {\n    fetchPosts(limit, page);\n  }, [page]);\n\n  const createPost = (newPost) => {\n    setPosts([...posts, newPost]);\n    setModal(false);\n  };\n  const removePost = (post) => {\n    setPosts(posts.filter((p) => p.id !== post.id));\n  };\n\n  const changePage = (page) => {\n    setPage(page);\n  };\n\n  return (\n    <div className=\"App\">\n      <MyButton style={{ marginTop: 30 }} onClick={() => setModal(true)}>\n        Create User\n      </MyButton>\n      <MyModal visible={modal} setVisible={setModal}>\n        <PostForm create={createPost} />\n      </MyModal>\n      <PostFilter filter={filter} setFilter={setFilter} />\n\n      <PostList remove={removePost} posts={sortedAndSearchedPosts} title=\"title\" />\n      <div ref={lastElement} style={{ height: 30 }}></div>\n      {isPostLoading && (\n        <div style={{ display: 'flex', justifyContent: 'center', marginTop: 50 }}>\n          {' '}\n          <Loader />\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default Post;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}