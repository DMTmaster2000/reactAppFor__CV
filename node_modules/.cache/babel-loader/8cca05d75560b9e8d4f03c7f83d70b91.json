{"ast":null,"code":"\"use strict\";\n\nvar messages = require(\"./connect-utils\");\n\nvar utils = require(\"./utils\");\n\nvar _ = require(\"./lodash.custom\");\n\nvar template = \"[{blue:%s}] \";\n\nvar logger = require(\"eazy-logger\").Logger({\n  useLevelPrefixes: false\n});\n\nmodule.exports.logger = logger;\n/**\n * @param name\n * @returns {*}\n */\n\nmodule.exports.getLogger = function (name) {\n  return logger.clone(function (config) {\n    config.prefix = config.prefix + template.replace(\"%s\", name);\n    return config;\n  });\n};\n/**\n * Logging Callbacks\n */\n\n\nmodule.exports.callbacks = {\n  /**\n   * Log when file-watching has started\n   * @param {BrowserSync} bs\n   * @param data\n   */\n  \"file:watching\": function (bs, data) {\n    if (Object.keys(data).length) {\n      logger.info(\"Watching files...\");\n    }\n  },\n\n  /**\n   * Log when a file changes\n   * @param {BrowserSync} bs\n   * @param data\n   */\n  \"file:reload\": function (bs, data) {\n    if (canLogFileChange(bs, data)) {\n      if (data.path[0] === \"*\") {\n        return logger.info(\"{cyan:Reloading files that match: {magenta:%s\", data.path);\n      }\n\n      logger.info(\"{cyan:File event [\" + data.event + \"] : {magenta:%s\", data.path);\n    }\n  },\n\n  /**\n   *\n   */\n  \"service:exit\": function () {\n    logger.debug(\"Exiting...\");\n  },\n\n  /**\n   *\n   */\n  \"browser:reload\": function (bs, data) {\n    if (data === void 0) {\n      data = {};\n    }\n\n    if (canLogFileChange(bs)) {\n      if (data.files && data.files.length > 1) {\n        return logger.info(\"{cyan:Reloading Browsers... (buffered \" + data.files.length + \" events)\");\n      }\n\n      logger.info(\"{cyan:Reloading Browsers...\");\n    }\n  },\n\n  /**\n   *\n   */\n  \"browser:error\": function () {\n    logger.error(\"Couldn't open browser (if you are using BrowserSync in a headless environment, you might want to set the {cyan:open} option to {cyan:false})\");\n  },\n\n  /**\n   * @param {BrowserSync} bs\n   * @param data\n   */\n  \"stream:changed\": function (bs, data) {\n    if (canLogFileChange(bs)) {\n      var changed = data.changed;\n      logger.info(\"{cyan:%s %s changed} ({magenta:%s})\", changed.length, changed.length > 1 ? \"files\" : \"file\", changed.join(\", \"));\n    }\n  },\n\n  /**\n   * Client connected logging\n   * @param {BrowserSync} bs\n   * @param data\n   */\n  \"client:connected\": function (bs, data) {\n    var uaString = utils.getUaString(data.ua);\n    var msg = \"{cyan:Browser Connected: {magenta:%s, version: %s}\";\n    var method = \"info\";\n\n    if (!bs.options.get(\"logConnections\")) {\n      method = \"debug\";\n    }\n\n    logger.log(method, msg, uaString.name, uaString.version);\n  },\n\n  /**\n   * Main logging when the service is running\n   * @param {BrowserSync} bs\n   * @param data\n   */\n  \"service:running\": function (bs, data) {\n    var type = data.type;\n\n    if (bs.options.get(\"json\")) {\n      return console.log(JSON.stringify({\n        \"service:running\": {\n          options: bs.options.toJS()\n        }\n      }));\n    }\n\n    if (type === \"server\") {\n      var baseDir = bs.options.getIn([\"server\", \"baseDir\"]);\n      logUrls(bs.options.get(\"urls\").toJS());\n\n      if (baseDir) {\n        if (utils.isList(baseDir)) {\n          baseDir.forEach(serveFiles);\n        } else {\n          serveFiles(baseDir);\n        }\n      }\n    }\n\n    if (type === \"proxy\") {\n      logger.info(\"Proxying: {cyan:%s}\", bs.options.getIn([\"proxy\", \"target\"]));\n      logUrls(bs.options.get(\"urls\").toJS());\n    }\n\n    if (type === \"snippet\") {\n      if (bs.options.get(\"logSnippet\")) {\n        logger.info(\"{bold:Copy the following snippet into your website, \" + \"just before the closing {cyan:</body>} tag\");\n        logger.unprefixed(\"info\", messages.scriptTags(bs.options));\n      }\n\n      logUrls(bs.options.get(\"urls\").filter(function (value, key) {\n        return key.slice(0, 2) === \"ui\";\n      }).toJS());\n    }\n\n    function serveFiles(base) {\n      logger.info(\"Serving files from: {magenta:%s}\", base);\n    }\n  }\n};\n/**\n * Plugin interface for BrowserSync\n * @param {EventEmitter} emitter\n * @param {BrowserSync} bs\n * @returns {Object}\n */\n\nmodule.exports.plugin = function (emitter, bs) {\n  var logPrefix = bs.options.get(\"logPrefix\");\n  var logLevel = bs.options.get(\"logLevel\"); // Should set logger level here!\n\n  logger.setLevel(logLevel);\n\n  if (logPrefix) {\n    if (_.isFunction(logPrefix)) {\n      logger.setPrefix(logPrefix);\n    } else {\n      logger.setPrefix(template.replace(\"%s\", logPrefix));\n    }\n  }\n\n  _.each(exports.callbacks, function (func, event) {\n    emitter.on(event, func.bind(this, bs));\n  });\n\n  return logger;\n};\n/**\n *\n * @param urls\n */\n\n\nfunction logUrls(urls) {\n  var keys = Object.keys(urls);\n  var longestName = 0;\n  var longesturl = 0;\n  var offset = 2;\n\n  if (!keys.length) {\n    return;\n  }\n\n  var names = keys.map(function (key) {\n    if (key.length > longestName) {\n      longestName = key.length;\n    }\n\n    if (urls[key].length > longesturl) {\n      longesturl = urls[key].length;\n    }\n\n    return key;\n  });\n  var underline = getChars(longestName + offset + longesturl + 1, \"-\");\n  var underlined = false;\n  logger.info(\"{bold:Access URLs:\");\n  logger.unprefixed(\"info\", \"{grey: %s\", underline);\n  keys.forEach(function (key, i) {\n    var keyname = getKeyName(key);\n    logger.unprefixed(\"info\", \" %s: {magenta:%s}\", getPadding(key.length, longestName + offset) + keyname, urls[key]);\n\n    if (!underlined && names[i + 1] && names[i + 1].indexOf(\"ui\") > -1) {\n      underlined = true;\n      logger.unprefixed(\"info\", \"{grey: %s}\", underline);\n    }\n  });\n  logger.unprefixed(\"info\", \"{grey: %s}\", underline);\n}\n/**\n * @param {Number} len\n * @param {Number} max\n * @returns {string}\n */\n\n\nfunction getPadding(len, max) {\n  return new Array(max - (len + 1)).join(\" \");\n}\n/**\n * @param {Number} len\n * @param {String} char\n * @returns {string}\n */\n\n\nfunction getChars(len, char) {\n  return new Array(len).join(char);\n}\n/**\n * Transform url-key names into something more presentable\n * @param key\n * @returns {string}\n */\n\n\nfunction getKeyName(key) {\n  if (key.indexOf(\"ui\") > -1) {\n    if (key === \"ui\") {\n      return \"UI\";\n    }\n\n    if (key === \"ui-external\") {\n      return \"UI External\";\n    }\n  }\n\n  return key.substr(0, 1).toUpperCase() + key.substring(1);\n}\n/**\n * Determine if file changes should be logged\n * @param bs\n * @param data\n * @returns {boolean}\n */\n\n\nfunction canLogFileChange(bs, data) {\n  if (data && data.log === false) {\n    return false;\n  }\n\n  return bs.options.get(\"logFileChanges\");\n}","map":{"version":3,"mappings":"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","names":["messages","require","utils","_","template","logger","Logger","useLevelPrefixes","module","exports","getLogger","name","clone","config","prefix","replace","callbacks","bs","data","Object","keys","length","info","canLogFileChange","path","event","debug","files","error","changed","join","uaString","getUaString","ua","msg","method","options","get","log","version","type","console","JSON","stringify","toJS","baseDir","getIn","logUrls","isList","forEach","serveFiles","unprefixed","scriptTags","filter","value","key","slice","base","plugin","emitter","logPrefix","logLevel","setLevel","isFunction","setPrefix","each","func","on","bind","urls","longestName","longesturl","offset","names","map","underline","getChars","underlined","i","keyname","getKeyName","getPadding","indexOf","len","max","Array","char","substr","toUpperCase","substring"],"sources":["../lib/logger.js"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}