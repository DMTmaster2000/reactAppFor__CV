{"ast":null,"code":"import _regeneratorRuntime from\"/Users/johnberetty/Desktop/my-app/my-app/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _toConsumableArray from\"/Users/johnberetty/Desktop/my-app/my-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"/Users/johnberetty/Desktop/my-app/my-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/johnberetty/Desktop/my-app/my-app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useMemo,useEffect}from'react';import PostFilter from'../components/PostFilter';import PostForm from'../components/PostForm';import PostList from'../components/PostList';import MyButton from'../components/UI/button/MyButton';import MyModal from'../components/UI/MyModal/MyModal';import{usePosts}from'../hooks/usePosts';import'../styles/App.css';import PostService from'../API/PostService';import Loader from'../components/UI/loader/Loader';import{useFetching}from'../hooks/useFetching';import{getPageCount,getPagesArray}from'../components/utils/pages';import Pagination from'../components/UI/pagination/Pagination';import{useRef}from'react';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Post(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),posts=_useState2[0],setPosts=_useState2[1];var _useState3=useState({sort:'',query:''}),_useState4=_slicedToArray(_useState3,2),filter=_useState4[0],setFilter=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),modal=_useState6[0],setModal=_useState6[1];var sortedAndSearchedPosts=usePosts(posts,filter.sort,filter.query);var _useState7=useState(0),_useState8=_slicedToArray(_useState7,2),totalPages=_useState8[0],setTotalPages=_useState8[1];var _useState9=useState(10),_useState10=_slicedToArray(_useState9,1),limit=_useState10[0];var _useState11=useState(1),_useState12=_slicedToArray(_useState11,2),page=_useState12[0],setPage=_useState12[1];var lastElement=useRef();var observer=useRef();var _useFetching=useFetching(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var response,totalCount;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return PostService.getAll(limit,page);case 2:response=_context.sent;setPosts([].concat(_toConsumableArray(posts),_toConsumableArray(response.data)));totalCount=response.headers['x-total-count'];setTotalPages(getPageCount(totalCount,limit));case 6:case\"end\":return _context.stop();}}},_callee);}))),_useFetching2=_slicedToArray(_useFetching,3),fetchPosts=_useFetching2[0],isPostLoading=_useFetching2[1],postError=_useFetching2[2];useEffect(function(){if(isPostLoading)return;if(observer.current)observer.current.disconnect();var callback=function callback(entries,observer){if(entries[0].isIntersecting&&page<totalPages){console.log(page);setPage(page+1);}};observer.current=new IntersectionObserver(callback);//console.log(observer.current);\nobserver.current.observe(lastElement.current);},[isPostLoading]);useEffect(function(){fetchPosts(limit,page);},[page]);var createPost=function createPost(newPost){setPosts([].concat(_toConsumableArray(posts),[newPost]));setModal(false);};var removePost=function removePost(post){setPosts(posts.filter(function(p){return p.id!==post.id;}));};var changePage=function changePage(page){setPage(page);};return/*#__PURE__*/_jsxs(\"div\",{className:\"App\",children:[/*#__PURE__*/_jsx(MyButton,{style:{marginTop:30},onClick:function onClick(){return setModal(true);},children:\"Create User\"}),/*#__PURE__*/_jsx(MyModal,{visible:modal,setVisible:setModal,children:/*#__PURE__*/_jsx(PostForm,{create:createPost})}),/*#__PURE__*/_jsx(PostFilter,{filter:filter,setFilter:setFilter}),/*#__PURE__*/_jsx(PostList,{remove:removePost,posts:sortedAndSearchedPosts,title:\"title\"}),/*#__PURE__*/_jsx(\"div\",{ref:lastElement,style:{height:30}}),isPostLoading&&/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'center',marginTop:50},children:[\" \",/*#__PURE__*/_jsx(Loader,{})]})]});}export default Post;","map":{"version":3,"names":["React","useState","useMemo","useEffect","PostFilter","PostForm","PostList","MyButton","MyModal","usePosts","PostService","Loader","useFetching","getPageCount","getPagesArray","Pagination","useRef","Post","posts","setPosts","sort","query","filter","setFilter","modal","setModal","sortedAndSearchedPosts","totalPages","setTotalPages","limit","page","setPage","lastElement","observer","getAll","response","data","totalCount","headers","fetchPosts","isPostLoading","postError","current","disconnect","callback","entries","isIntersecting","console","log","IntersectionObserver","observe","createPost","newPost","removePost","post","p","id","changePage","marginTop","height","display","justifyContent"],"sources":["/Users/johnberetty/Desktop/my-app/my-app/src/pages/Post.jsx"],"sourcesContent":["import React, { useState, useMemo, useEffect } from 'react'\nimport PostFilter from '../components/PostFilter';\nimport PostForm from '../components/PostForm';\nimport PostList from '../components/PostList';\nimport MyButton from '../components/UI/button/MyButton'\nimport MyModal from '../components/UI/MyModal/MyModal';\nimport { usePosts } from '../hooks/usePosts';\nimport '../styles/App.css'\nimport PostService from '../API/PostService';\nimport Loader from '../components/UI/loader/Loader';\nimport { useFetching } from '../hooks/useFetching';\nimport { getPageCount, getPagesArray } from '../components/utils/pages';\nimport Pagination from '../components/UI/pagination/Pagination';\nimport { useRef } from 'react';\n\nfunction Post() {\n\n\tconst [posts, setPosts] = useState([])\n\tconst [filter, setFilter] = useState({ sort: '', query: '' })\n\tconst [modal, setModal] = useState(false)\n\tconst sortedAndSearchedPosts = usePosts(posts, filter.sort, filter.query)\n\tconst [totalPages, setTotalPages] = useState(0)\n\tconst [limit] = useState(10)\n\tconst [page, setPage] = useState(1)\n\tconst lastElement = useRef()\n\tconst observer = useRef()\n\n\tconst [fetchPosts, isPostLoading, postError] = useFetching(async () => {\n\t\tconst response = await PostService.getAll(limit, page)\n\t\tsetPosts([...posts, ...response.data]);\n\t\tconst totalCount = response.headers['x-total-count']\n\t\tsetTotalPages(getPageCount(totalCount, limit))\n\t})\n\n\tuseEffect(() => {\n\t\tif (isPostLoading) return\n\t\tif (observer.current) observer.current.disconnect()\n\t\tvar callback = function (entries, observer) {\n\t\t\tif (entries[0].isIntersecting && page < totalPages) {\n\t\t\t\tconsole.log(page);\n\t\t\t\tsetPage(page + 1)\n\t\t\t}\n\n\t\t};\n\t\tobserver.current = new IntersectionObserver(callback);\n\t\t//console.log(observer.current);\n\t\tobserver.current.observe(lastElement.current)\n\t}, [isPostLoading])\n\n\n\tuseEffect(() => {\n\t\tfetchPosts(limit, page)\n\t}, [page])\n\n\tconst createPost = (newPost) => {\n\t\tsetPosts([...posts, newPost])\n\t\tsetModal(false)\n\t}\n\tconst removePost = (post) => {\n\t\tsetPosts(posts.filter(p => p.id !== post.id))\n\t}\n\n\tconst changePage = (page) => {\n\t\tsetPage(page)\n\t}\n\n\n\treturn (\n\t\t<div className=\"App\">\n\t\t\t<MyButton style={{ marginTop: 30 }} onClick={() => setModal(true)} >\n\t\t\t\tCreate User\n\t\t\t</MyButton>\n\t\t\t<MyModal\n\t\t\t\tvisible={modal}\n\t\t\t\tsetVisible={setModal}>\n\t\t\t\t<PostForm create={createPost} />\n\t\t\t</MyModal>\n\n\n\t\t\t<PostFilter\n\t\t\t\tfilter={filter}\n\t\t\t\tsetFilter={setFilter}\n\t\t\t/>\n\n\t\t\t<PostList remove={removePost} posts={sortedAndSearchedPosts} title='title' />\n\t\t\t<div ref={lastElement} style={{ height: 30 }}></div>\n\t\t\t{isPostLoading &&\n\t\t\t\t<div style={{ display: 'flex', justifyContent: 'center', marginTop: 50 }}> <Loader /></div>\n\t\t\t}\n\n\n\t\t</div>\n\t);\n}\n\nexport default Post;\n\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}