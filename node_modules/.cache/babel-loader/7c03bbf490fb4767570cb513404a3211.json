{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar path = require(\"path\");\n\nvar fs_1 = require(\"fs\");\n\nvar immutable_1 = require(\"immutable\");\n\nvar utils = require(\"../utils\");\n\nvar cli_options_1 = require(\"./cli-options\");\n\nvar _ = require(\"../lodash.custom\");\n/**\n * $ browser-sync start <options>\n *\n * This commands starts the Browsersync servers\n * & Optionally UI.\n *\n * @param opts\n * @returns {Function}\n */\n\n\nfunction default_1(opts) {\n  var flags = preprocessFlags(opts.cli.flags);\n  var cwd = flags.cwd || process.cwd();\n  var maybepkg = path.resolve(cwd, \"package.json\");\n  var input = flags;\n\n  if (flags.config) {\n    var maybeconf = path.resolve(cwd, flags.config);\n\n    if (fs_1.existsSync(maybeconf)) {\n      var conf = require(maybeconf);\n\n      input = _.merge({}, conf, flags);\n    } else {\n      utils.fail(true, new Error(\"Configuration file '\" + flags.config + \"' not found\"), opts.cb);\n    }\n  } else {\n    if (fs_1.existsSync(maybepkg)) {\n      var pkg = require(maybepkg);\n\n      if (pkg[\"browser-sync\"]) {\n        console.log(\"> Configuration obtained from package.json\");\n        input = _.merge({}, pkg[\"browser-sync\"], flags);\n      }\n    }\n  }\n\n  return require(\"../\").create(\"cli\").init(input, opts.cb);\n}\n\nexports.default = default_1;\n/**\n * @param flags\n * @returns {*}\n */\n\nfunction preprocessFlags(flags) {\n  return [stripUndefined, legacyFilesArgs, removeWatchBooleanWhenFalse].reduce(function (flags, fn) {\n    return fn.call(null, flags);\n  }, flags);\n}\n/**\n * Incoming undefined values are problematic as\n * they interfere with Immutable.Map.mergeDeep\n * @param subject\n * @returns {*}\n */\n\n\nfunction stripUndefined(subject) {\n  return Object.keys(subject).reduce(function (acc, key) {\n    var value = subject[key];\n\n    if (typeof value === \"undefined\") {\n      return acc;\n    }\n\n    acc[key] = value;\n    return acc;\n  }, {});\n}\n/**\n * @param flags\n * @returns {*}\n */\n\n\nfunction legacyFilesArgs(flags) {\n  if (flags.files && flags.files.length) {\n    flags.files = flags.files.reduce(function (acc, item) {\n      return acc.concat(cli_options_1.explodeFilesArg(item));\n    }, []);\n  }\n\n  return flags;\n}\n/**\n * `watch` is a CLI boolean so should be removed if false to\n * allow config to set watch: true\n * @param flags\n * @returns {any}\n */\n\n\nfunction removeWatchBooleanWhenFalse(flags) {\n  if (flags.watch === false) {\n    return immutable_1.fromJS(flags).delete(\"watch\").toJS();\n  }\n\n  return flags;\n}","map":{"version":3,"mappings":"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","names":["_","require","opts","flags","preprocessFlags","cli","cwd","process","maybepkg","path","resolve","input","config","maybeconf","fs_1","conf","merge","utils","fail","Error","cb","pkg","console","log","create","init","exports","stripUndefined","legacyFilesArgs","removeWatchBooleanWhenFalse","reduce","fn","call","subject","Object","keys","acc","key","value","files","length","item","concat","cli_options_1","watch","immutable_1","delete","toJS"],"sources":["../../lib/cli/command.start.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}