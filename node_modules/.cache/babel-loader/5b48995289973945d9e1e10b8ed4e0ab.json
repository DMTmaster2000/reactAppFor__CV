{"ast":null,"code":"'use strict';\n/**\n * Module dependencies.\n */\n\nvar http = require('http');\n\nvar read = require('fs').readFileSync;\n\nvar path = require('path');\n\nvar exists = require('fs').existsSync;\n\nvar engine = require('engine.io');\n\nvar clientVersion = require('socket.io-client/package.json').version;\n\nvar Client = require('./client');\n\nvar Emitter = require('events').EventEmitter;\n\nvar Namespace = require('./namespace');\n\nvar ParentNamespace = require('./parent-namespace');\n\nvar Adapter = require('socket.io-adapter');\n\nvar parser = require('socket.io-parser');\n\nvar debug = require('debug')('socket.io:server');\n\nvar url = require('url');\n/**\n * Module exports.\n */\n\n\nmodule.exports = Server;\n/**\n * Socket.IO client source.\n */\n\nvar clientSource = undefined;\nvar clientSourceMap = undefined;\n/**\n * Server constructor.\n *\n * @param {http.Server|Number|Object} srv http server, port or options\n * @param {Object} [opts]\n * @api public\n */\n\nfunction Server(srv, opts) {\n  if (!(this instanceof Server)) return new Server(srv, opts);\n\n  if ('object' == typeof srv && srv instanceof Object && !srv.listen) {\n    opts = srv;\n    srv = null;\n  }\n\n  opts = opts || {};\n  this.nsps = {};\n  this.parentNsps = new Map();\n  this.path(opts.path || '/socket.io');\n  this.serveClient(false !== opts.serveClient);\n  this.parser = opts.parser || parser;\n  this.encoder = new this.parser.Encoder();\n  this.adapter(opts.adapter || Adapter);\n  this.origins(opts.origins || []);\n  this.sockets = this.of('/');\n  if (srv) this.attach(srv, opts);\n}\n/**\n * Server request verification function, that checks for allowed origins\n *\n * @param {http.IncomingMessage} req request\n * @param {Function} fn callback to be called with the result: `fn(err, success)`\n */\n\n\nServer.prototype.checkRequest = function (req, fn) {\n  const origin = req.headers.origin;\n\n  if (typeof this._origins === 'function') {\n    return this._origins(origin, fn);\n  }\n\n  if (origin) {\n    fn(null, this._origins.includes(origin));\n  } else {\n    const noOriginIsValid = this._origins.length === 0;\n    fn(null, noOriginIsValid);\n  }\n};\n/**\n * Sets/gets whether client code is being served.\n *\n * @param {Boolean} v whether to serve client code\n * @return {Server|Boolean} self when setting or value when getting\n * @api public\n */\n\n\nServer.prototype.serveClient = function (v) {\n  if (!arguments.length) return this._serveClient;\n  this._serveClient = v;\n\n  var resolvePath = function (file) {\n    var filepath = path.resolve(__dirname, './../../', file);\n\n    if (exists(filepath)) {\n      return filepath;\n    }\n\n    return require.resolve(file);\n  };\n\n  if (v && !clientSource) {\n    clientSource = read(resolvePath('socket.io-client/dist/socket.io.js'), 'utf-8');\n\n    try {\n      clientSourceMap = read(resolvePath('socket.io-client/dist/socket.io.js.map'), 'utf-8');\n    } catch (err) {\n      debug('could not load sourcemap file');\n    }\n  }\n\n  return this;\n};\n/**\n * Old settings for backwards compatibility\n */\n\n\nvar oldSettings = {\n  \"transports\": \"transports\",\n  \"heartbeat timeout\": \"pingTimeout\",\n  \"heartbeat interval\": \"pingInterval\",\n  \"destroy buffer size\": \"maxHttpBufferSize\"\n};\n/**\n * Backwards compatibility.\n *\n * @api public\n */\n\nServer.prototype.set = function (key, val) {\n  if ('authorization' == key && val) {\n    this.use(function (socket, next) {\n      val(socket.request, function (err, authorized) {\n        if (err) return next(new Error(err));\n        if (!authorized) return next(new Error('Not authorized'));\n        next();\n      });\n    });\n  } else if ('origins' == key && val) {\n    this.origins(val);\n  } else if ('resource' == key) {\n    this.path(val);\n  } else if (oldSettings[key] && this.eio[oldSettings[key]]) {\n    this.eio[oldSettings[key]] = val;\n  } else {\n    console.error('Option %s is not valid. Please refer to the README.', key);\n  }\n\n  return this;\n};\n/**\n * Executes the middleware for an incoming namespace not already created on the server.\n *\n * @param {String} name name of incoming namespace\n * @param {Object} query the query parameters\n * @param {Function} fn callback\n * @api private\n */\n\n\nServer.prototype.checkNamespace = function (name, query, fn) {\n  if (this.parentNsps.size === 0) return fn(false);\n  const keysIterator = this.parentNsps.keys();\n\n  const run = () => {\n    let nextFn = keysIterator.next();\n\n    if (nextFn.done) {\n      return fn(false);\n    }\n\n    nextFn.value(name, query, (err, allow) => {\n      if (err || !allow) {\n        run();\n      } else {\n        fn(this.parentNsps.get(nextFn.value).createChild(name));\n      }\n    });\n  };\n\n  run();\n};\n/**\n * Sets the client serving path.\n *\n * @param {String} v pathname\n * @return {Server|String} self when setting or value when getting\n * @api public\n */\n\n\nServer.prototype.path = function (v) {\n  if (!arguments.length) return this._path;\n  this._path = v.replace(/\\/$/, '');\n  return this;\n};\n/**\n * Sets the adapter for rooms.\n *\n * @param {Adapter} v pathname\n * @return {Server|Adapter} self when setting or value when getting\n * @api public\n */\n\n\nServer.prototype.adapter = function (v) {\n  if (!arguments.length) return this._adapter;\n  this._adapter = v;\n\n  for (var i in this.nsps) {\n    if (this.nsps.hasOwnProperty(i)) {\n      this.nsps[i].initAdapter();\n    }\n  }\n\n  return this;\n};\n/**\n * Sets the allowed origins for requests.\n *\n * @param {String|String[]} v origins\n * @return {Server|Adapter} self when setting or value when getting\n * @api public\n */\n\n\nServer.prototype.origins = function (v) {\n  if (!arguments.length) return this._origins;\n  this._origins = typeof v === 'string' ? [v] : v;\n  return this;\n};\n/**\n * Attaches socket.io to a server or port.\n *\n * @param {http.Server|Number} server or port\n * @param {Object} options passed to engine.io\n * @return {Server} self\n * @api public\n */\n\n\nServer.prototype.listen = Server.prototype.attach = function (srv, opts) {\n  if ('function' == typeof srv) {\n    var msg = 'You are trying to attach socket.io to an express ' + 'request handler function. Please pass a http.Server instance.';\n    throw new Error(msg);\n  } // handle a port as a string\n\n\n  if (Number(srv) == srv) {\n    srv = Number(srv);\n  }\n\n  if ('number' == typeof srv) {\n    debug('creating http server and binding to %d', srv);\n    var port = srv;\n    srv = http.Server(function (req, res) {\n      res.writeHead(404);\n      res.end();\n    });\n    srv.listen(port);\n  } // set engine.io path to `/socket.io`\n\n\n  opts = opts || {};\n  opts.path = opts.path || this.path(); // set origins verification\n\n  opts.allowRequest = opts.allowRequest || this.checkRequest.bind(this);\n\n  if (this.sockets.fns.length > 0) {\n    this.initEngine(srv, opts);\n    return this;\n  }\n\n  var self = this;\n  var connectPacket = {\n    type: parser.CONNECT,\n    nsp: '/'\n  };\n  this.encoder.encode(connectPacket, function (encodedPacket) {\n    // the CONNECT packet will be merged with Engine.IO handshake,\n    // to reduce the number of round trips\n    opts.initialPacket = encodedPacket;\n    self.initEngine(srv, opts);\n  });\n  return this;\n};\n/**\n * Initialize engine\n *\n * @param {Object} options passed to engine.io\n * @api private\n */\n\n\nServer.prototype.initEngine = function (srv, opts) {\n  // initialize engine\n  debug('creating engine.io instance with opts %j', opts);\n  this.eio = engine.attach(srv, opts); // attach static file serving\n\n  if (this._serveClient) this.attachServe(srv); // Export http server\n\n  this.httpServer = srv; // bind to engine events\n\n  this.bind(this.eio);\n};\n/**\n * Attaches the static file serving.\n *\n * @param {Function|http.Server} srv http server\n * @api private\n */\n\n\nServer.prototype.attachServe = function (srv) {\n  debug('attaching client serving req handler');\n  var url = this._path + '/socket.io.js';\n  var urlMap = this._path + '/socket.io.js.map';\n  var evs = srv.listeners('request').slice(0);\n  var self = this;\n  srv.removeAllListeners('request');\n  srv.on('request', function (req, res) {\n    if (0 === req.url.indexOf(urlMap)) {\n      self.serveMap(req, res);\n    } else if (0 === req.url.indexOf(url)) {\n      self.serve(req, res);\n    } else {\n      for (var i = 0; i < evs.length; i++) {\n        evs[i].call(srv, req, res);\n      }\n    }\n  });\n};\n/**\n * Handles a request serving `/socket.io.js`\n *\n * @param {http.Request} req\n * @param {http.Response} res\n * @api private\n */\n\n\nServer.prototype.serve = function (req, res) {\n  // Per the standard, ETags must be quoted:\n  // https://tools.ietf.org/html/rfc7232#section-2.3\n  var expectedEtag = '\"' + clientVersion + '\"';\n  var etag = req.headers['if-none-match'];\n\n  if (etag) {\n    if (expectedEtag == etag) {\n      debug('serve client 304');\n      res.writeHead(304);\n      res.end();\n      return;\n    }\n  }\n\n  debug('serve client source');\n  res.setHeader(\"Cache-Control\", \"public, max-age=0\");\n  res.setHeader('Content-Type', 'application/javascript');\n  res.setHeader('ETag', expectedEtag);\n  res.writeHead(200);\n  res.end(clientSource);\n};\n/**\n * Handles a request serving `/socket.io.js.map`\n *\n * @param {http.Request} req\n * @param {http.Response} res\n * @api private\n */\n\n\nServer.prototype.serveMap = function (req, res) {\n  // Per the standard, ETags must be quoted:\n  // https://tools.ietf.org/html/rfc7232#section-2.3\n  var expectedEtag = '\"' + clientVersion + '\"';\n  var etag = req.headers['if-none-match'];\n\n  if (etag) {\n    if (expectedEtag == etag) {\n      debug('serve client 304');\n      res.writeHead(304);\n      res.end();\n      return;\n    }\n  }\n\n  debug('serve client sourcemap');\n  res.setHeader('Content-Type', 'application/json');\n  res.setHeader('ETag', expectedEtag);\n  res.writeHead(200);\n  res.end(clientSourceMap);\n};\n/**\n * Binds socket.io to an engine.io instance.\n *\n * @param {engine.Server} engine engine.io (or compatible) server\n * @return {Server} self\n * @api public\n */\n\n\nServer.prototype.bind = function (engine) {\n  this.engine = engine;\n  this.engine.on('connection', this.onconnection.bind(this));\n  return this;\n};\n/**\n * Called with each incoming transport connection.\n *\n * @param {engine.Socket} conn\n * @return {Server} self\n * @api public\n */\n\n\nServer.prototype.onconnection = function (conn) {\n  debug('incoming connection with id %s', conn.id);\n  var client = new Client(this, conn);\n  client.connect('/');\n  return this;\n};\n/**\n * Looks up a namespace.\n *\n * @param {String|RegExp|Function} name nsp name\n * @param {Function} [fn] optional, nsp `connection` ev handler\n * @api public\n */\n\n\nServer.prototype.of = function (name, fn) {\n  if (typeof name === 'function' || name instanceof RegExp) {\n    const parentNsp = new ParentNamespace(this);\n    debug('initializing parent namespace %s', parentNsp.name);\n\n    if (typeof name === 'function') {\n      this.parentNsps.set(name, parentNsp);\n    } else {\n      this.parentNsps.set((nsp, conn, next) => next(null, name.test(nsp)), parentNsp);\n    }\n\n    if (fn) parentNsp.on('connect', fn);\n    return parentNsp;\n  }\n\n  if (String(name)[0] !== '/') name = '/' + name;\n  var nsp = this.nsps[name];\n\n  if (!nsp) {\n    debug('initializing namespace %s', name);\n    nsp = new Namespace(this, name);\n    this.nsps[name] = nsp;\n  }\n\n  if (fn) nsp.on('connect', fn);\n  return nsp;\n};\n/**\n * Closes server connection\n *\n * @param {Function} [fn] optional, called as `fn([err])` on error OR all conns closed\n * @api public\n */\n\n\nServer.prototype.close = function (fn) {\n  for (var id in this.nsps['/'].sockets) {\n    if (this.nsps['/'].sockets.hasOwnProperty(id)) {\n      this.nsps['/'].sockets[id].onclose();\n    }\n  }\n\n  this.engine.close();\n\n  if (this.httpServer) {\n    this.httpServer.close(fn);\n  } else {\n    fn && fn();\n  }\n};\n/**\n * Expose main namespace (/).\n */\n\n\nvar emitterMethods = Object.keys(Emitter.prototype).filter(function (key) {\n  return typeof Emitter.prototype[key] === 'function';\n});\nemitterMethods.concat(['to', 'in', 'use', 'send', 'write', 'clients', 'compress', 'binary']).forEach(function (fn) {\n  Server.prototype[fn] = function () {\n    return this.sockets[fn].apply(this.sockets, arguments);\n  };\n});\nNamespace.flags.forEach(function (flag) {\n  Object.defineProperty(Server.prototype, flag, {\n    get: function () {\n      this.sockets.flags = this.sockets.flags || {};\n      this.sockets.flags[flag] = true;\n      return this;\n    }\n  });\n});\n/**\n * BC with `io.listen`\n */\n\nServer.listen = Server;","map":{"version":3,"names":["http","require","read","readFileSync","path","exists","existsSync","engine","clientVersion","version","Client","Emitter","EventEmitter","Namespace","ParentNamespace","Adapter","parser","debug","url","module","exports","Server","clientSource","undefined","clientSourceMap","srv","opts","Object","listen","nsps","parentNsps","Map","serveClient","encoder","Encoder","adapter","origins","sockets","of","attach","prototype","checkRequest","req","fn","origin","headers","_origins","includes","noOriginIsValid","length","v","arguments","_serveClient","resolvePath","file","filepath","resolve","__dirname","err","oldSettings","set","key","val","use","socket","next","request","authorized","Error","eio","console","error","checkNamespace","name","query","size","keysIterator","keys","run","nextFn","done","value","allow","get","createChild","_path","replace","_adapter","i","hasOwnProperty","initAdapter","msg","Number","port","res","writeHead","end","allowRequest","bind","fns","initEngine","self","connectPacket","type","CONNECT","nsp","encode","encodedPacket","initialPacket","attachServe","httpServer","urlMap","evs","listeners","slice","removeAllListeners","on","indexOf","serveMap","serve","call","expectedEtag","etag","setHeader","onconnection","conn","id","client","connect","RegExp","parentNsp","test","String","close","onclose","emitterMethods","filter","concat","forEach","apply","flags","flag","defineProperty"],"sources":["/Users/johnberetty/node_modules/socket.io/lib/index.js"],"sourcesContent":["'use strict';\n\n/**\n * Module dependencies.\n */\n\nvar http = require('http');\nvar read = require('fs').readFileSync;\nvar path = require('path');\nvar exists = require('fs').existsSync;\nvar engine = require('engine.io');\nvar clientVersion = require('socket.io-client/package.json').version;\nvar Client = require('./client');\nvar Emitter = require('events').EventEmitter;\nvar Namespace = require('./namespace');\nvar ParentNamespace = require('./parent-namespace');\nvar Adapter = require('socket.io-adapter');\nvar parser = require('socket.io-parser');\nvar debug = require('debug')('socket.io:server');\nvar url = require('url');\n\n/**\n * Module exports.\n */\n\nmodule.exports = Server;\n\n/**\n * Socket.IO client source.\n */\n\nvar clientSource = undefined;\nvar clientSourceMap = undefined;\n\n/**\n * Server constructor.\n *\n * @param {http.Server|Number|Object} srv http server, port or options\n * @param {Object} [opts]\n * @api public\n */\n\nfunction Server(srv, opts){\n  if (!(this instanceof Server)) return new Server(srv, opts);\n  if ('object' == typeof srv && srv instanceof Object && !srv.listen) {\n    opts = srv;\n    srv = null;\n  }\n  opts = opts || {};\n  this.nsps = {};\n  this.parentNsps = new Map();\n  this.path(opts.path || '/socket.io');\n  this.serveClient(false !== opts.serveClient);\n  this.parser = opts.parser || parser;\n  this.encoder = new this.parser.Encoder();\n  this.adapter(opts.adapter || Adapter);\n  this.origins(opts.origins || []);\n  this.sockets = this.of('/');\n  if (srv) this.attach(srv, opts);\n}\n\n/**\n * Server request verification function, that checks for allowed origins\n *\n * @param {http.IncomingMessage} req request\n * @param {Function} fn callback to be called with the result: `fn(err, success)`\n */\n\nServer.prototype.checkRequest = function(req, fn) {\n  const origin = req.headers.origin;\n\n  if (typeof this._origins === 'function') {\n    return this._origins(origin, fn);\n  }\n\n  if (origin) {\n    fn(null, this._origins.includes(origin));\n  } else {\n    const noOriginIsValid = this._origins.length === 0;\n    fn(null, noOriginIsValid);\n  }\n};\n\n/**\n * Sets/gets whether client code is being served.\n *\n * @param {Boolean} v whether to serve client code\n * @return {Server|Boolean} self when setting or value when getting\n * @api public\n */\n\nServer.prototype.serveClient = function(v){\n  if (!arguments.length) return this._serveClient;\n  this._serveClient = v;\n  var resolvePath = function(file){\n    var filepath = path.resolve(__dirname, './../../', file);\n    if (exists(filepath)) {\n      return filepath;\n    }\n    return require.resolve(file);\n  };\n  if (v && !clientSource) {\n    clientSource = read(resolvePath( 'socket.io-client/dist/socket.io.js'), 'utf-8');\n    try {\n      clientSourceMap = read(resolvePath( 'socket.io-client/dist/socket.io.js.map'), 'utf-8');\n    } catch(err) {\n      debug('could not load sourcemap file');\n    }\n  }\n  return this;\n};\n\n/**\n * Old settings for backwards compatibility\n */\n\nvar oldSettings = {\n  \"transports\": \"transports\",\n  \"heartbeat timeout\": \"pingTimeout\",\n  \"heartbeat interval\": \"pingInterval\",\n  \"destroy buffer size\": \"maxHttpBufferSize\"\n};\n\n/**\n * Backwards compatibility.\n *\n * @api public\n */\n\nServer.prototype.set = function(key, val){\n  if ('authorization' == key && val) {\n    this.use(function(socket, next) {\n      val(socket.request, function(err, authorized) {\n        if (err) return next(new Error(err));\n        if (!authorized) return next(new Error('Not authorized'));\n        next();\n      });\n    });\n  } else if ('origins' == key && val) {\n    this.origins(val);\n  } else if ('resource' == key) {\n    this.path(val);\n  } else if (oldSettings[key] && this.eio[oldSettings[key]]) {\n    this.eio[oldSettings[key]] = val;\n  } else {\n    console.error('Option %s is not valid. Please refer to the README.', key);\n  }\n\n  return this;\n};\n\n/**\n * Executes the middleware for an incoming namespace not already created on the server.\n *\n * @param {String} name name of incoming namespace\n * @param {Object} query the query parameters\n * @param {Function} fn callback\n * @api private\n */\n\nServer.prototype.checkNamespace = function(name, query, fn){\n  if (this.parentNsps.size === 0) return fn(false);\n\n  const keysIterator = this.parentNsps.keys();\n\n  const run = () => {\n    let nextFn = keysIterator.next();\n    if (nextFn.done) {\n      return fn(false);\n    }\n    nextFn.value(name, query, (err, allow) => {\n      if (err || !allow) {\n        run();\n      } else {\n        fn(this.parentNsps.get(nextFn.value).createChild(name));\n      }\n    });\n  };\n\n  run();\n};\n\n/**\n * Sets the client serving path.\n *\n * @param {String} v pathname\n * @return {Server|String} self when setting or value when getting\n * @api public\n */\n\nServer.prototype.path = function(v){\n  if (!arguments.length) return this._path;\n  this._path = v.replace(/\\/$/, '');\n  return this;\n};\n\n/**\n * Sets the adapter for rooms.\n *\n * @param {Adapter} v pathname\n * @return {Server|Adapter} self when setting or value when getting\n * @api public\n */\n\nServer.prototype.adapter = function(v){\n  if (!arguments.length) return this._adapter;\n  this._adapter = v;\n  for (var i in this.nsps) {\n    if (this.nsps.hasOwnProperty(i)) {\n      this.nsps[i].initAdapter();\n    }\n  }\n  return this;\n};\n\n/**\n * Sets the allowed origins for requests.\n *\n * @param {String|String[]} v origins\n * @return {Server|Adapter} self when setting or value when getting\n * @api public\n */\n\nServer.prototype.origins = function(v){\n  if (!arguments.length) return this._origins;\n\n  this._origins = typeof v === 'string' ? [v] : v;\n  return this;\n};\n\n/**\n * Attaches socket.io to a server or port.\n *\n * @param {http.Server|Number} server or port\n * @param {Object} options passed to engine.io\n * @return {Server} self\n * @api public\n */\n\nServer.prototype.listen =\nServer.prototype.attach = function(srv, opts){\n  if ('function' == typeof srv) {\n    var msg = 'You are trying to attach socket.io to an express ' +\n    'request handler function. Please pass a http.Server instance.';\n    throw new Error(msg);\n  }\n\n  // handle a port as a string\n  if (Number(srv) == srv) {\n    srv = Number(srv);\n  }\n\n  if ('number' == typeof srv) {\n    debug('creating http server and binding to %d', srv);\n    var port = srv;\n    srv = http.Server(function(req, res){\n      res.writeHead(404);\n      res.end();\n    });\n    srv.listen(port);\n\n  }\n\n  // set engine.io path to `/socket.io`\n  opts = opts || {};\n  opts.path = opts.path || this.path();\n  // set origins verification\n  opts.allowRequest = opts.allowRequest || this.checkRequest.bind(this);\n\n  if (this.sockets.fns.length > 0) {\n    this.initEngine(srv, opts);\n    return this;\n  }\n\n  var self = this;\n  var connectPacket = { type: parser.CONNECT, nsp: '/' };\n  this.encoder.encode(connectPacket, function (encodedPacket){\n    // the CONNECT packet will be merged with Engine.IO handshake,\n    // to reduce the number of round trips\n    opts.initialPacket = encodedPacket;\n\n    self.initEngine(srv, opts);\n  });\n  return this;\n};\n\n/**\n * Initialize engine\n *\n * @param {Object} options passed to engine.io\n * @api private\n */\n\nServer.prototype.initEngine = function(srv, opts){\n  // initialize engine\n  debug('creating engine.io instance with opts %j', opts);\n  this.eio = engine.attach(srv, opts);\n\n  // attach static file serving\n  if (this._serveClient) this.attachServe(srv);\n\n  // Export http server\n  this.httpServer = srv;\n\n  // bind to engine events\n  this.bind(this.eio);\n};\n\n/**\n * Attaches the static file serving.\n *\n * @param {Function|http.Server} srv http server\n * @api private\n */\n\nServer.prototype.attachServe = function(srv){\n  debug('attaching client serving req handler');\n  var url = this._path + '/socket.io.js';\n  var urlMap = this._path + '/socket.io.js.map';\n  var evs = srv.listeners('request').slice(0);\n  var self = this;\n  srv.removeAllListeners('request');\n  srv.on('request', function(req, res) {\n    if (0 === req.url.indexOf(urlMap)) {\n      self.serveMap(req, res);\n    } else if (0 === req.url.indexOf(url)) {\n      self.serve(req, res);\n    } else {\n      for (var i = 0; i < evs.length; i++) {\n        evs[i].call(srv, req, res);\n      }\n    }\n  });\n};\n\n/**\n * Handles a request serving `/socket.io.js`\n *\n * @param {http.Request} req\n * @param {http.Response} res\n * @api private\n */\n\nServer.prototype.serve = function(req, res){\n  // Per the standard, ETags must be quoted:\n  // https://tools.ietf.org/html/rfc7232#section-2.3\n  var expectedEtag = '\"' + clientVersion + '\"';\n\n  var etag = req.headers['if-none-match'];\n  if (etag) {\n    if (expectedEtag == etag) {\n      debug('serve client 304');\n      res.writeHead(304);\n      res.end();\n      return;\n    }\n  }\n\n  debug('serve client source');\n  res.setHeader(\"Cache-Control\", \"public, max-age=0\");\n  res.setHeader('Content-Type', 'application/javascript');\n  res.setHeader('ETag', expectedEtag);\n  res.writeHead(200);\n  res.end(clientSource);\n};\n\n/**\n * Handles a request serving `/socket.io.js.map`\n *\n * @param {http.Request} req\n * @param {http.Response} res\n * @api private\n */\n\nServer.prototype.serveMap = function(req, res){\n  // Per the standard, ETags must be quoted:\n  // https://tools.ietf.org/html/rfc7232#section-2.3\n  var expectedEtag = '\"' + clientVersion + '\"';\n\n  var etag = req.headers['if-none-match'];\n  if (etag) {\n    if (expectedEtag == etag) {\n      debug('serve client 304');\n      res.writeHead(304);\n      res.end();\n      return;\n    }\n  }\n\n  debug('serve client sourcemap');\n  res.setHeader('Content-Type', 'application/json');\n  res.setHeader('ETag', expectedEtag);\n  res.writeHead(200);\n  res.end(clientSourceMap);\n};\n\n/**\n * Binds socket.io to an engine.io instance.\n *\n * @param {engine.Server} engine engine.io (or compatible) server\n * @return {Server} self\n * @api public\n */\n\nServer.prototype.bind = function(engine){\n  this.engine = engine;\n  this.engine.on('connection', this.onconnection.bind(this));\n  return this;\n};\n\n/**\n * Called with each incoming transport connection.\n *\n * @param {engine.Socket} conn\n * @return {Server} self\n * @api public\n */\n\nServer.prototype.onconnection = function(conn){\n  debug('incoming connection with id %s', conn.id);\n  var client = new Client(this, conn);\n  client.connect('/');\n  return this;\n};\n\n/**\n * Looks up a namespace.\n *\n * @param {String|RegExp|Function} name nsp name\n * @param {Function} [fn] optional, nsp `connection` ev handler\n * @api public\n */\n\nServer.prototype.of = function(name, fn){\n  if (typeof name === 'function' || name instanceof RegExp) {\n    const parentNsp = new ParentNamespace(this);\n    debug('initializing parent namespace %s', parentNsp.name);\n    if (typeof name === 'function') {\n      this.parentNsps.set(name, parentNsp);\n    } else {\n      this.parentNsps.set((nsp, conn, next) => next(null, name.test(nsp)), parentNsp);\n    }\n    if (fn) parentNsp.on('connect', fn);\n    return parentNsp;\n  }\n\n  if (String(name)[0] !== '/') name = '/' + name;\n\n  var nsp = this.nsps[name];\n  if (!nsp) {\n    debug('initializing namespace %s', name);\n    nsp = new Namespace(this, name);\n    this.nsps[name] = nsp;\n  }\n  if (fn) nsp.on('connect', fn);\n  return nsp;\n};\n\n/**\n * Closes server connection\n *\n * @param {Function} [fn] optional, called as `fn([err])` on error OR all conns closed\n * @api public\n */\n\nServer.prototype.close = function(fn){\n  for (var id in this.nsps['/'].sockets) {\n    if (this.nsps['/'].sockets.hasOwnProperty(id)) {\n      this.nsps['/'].sockets[id].onclose();\n    }\n  }\n\n  this.engine.close();\n\n  if (this.httpServer) {\n    this.httpServer.close(fn);\n  } else {\n    fn && fn();\n  }\n};\n\n/**\n * Expose main namespace (/).\n */\n\nvar emitterMethods = Object.keys(Emitter.prototype).filter(function(key){\n  return typeof Emitter.prototype[key] === 'function';\n});\n\nemitterMethods.concat(['to', 'in', 'use', 'send', 'write', 'clients', 'compress', 'binary']).forEach(function(fn){\n  Server.prototype[fn] = function(){\n    return this.sockets[fn].apply(this.sockets, arguments);\n  };\n});\n\nNamespace.flags.forEach(function(flag){\n  Object.defineProperty(Server.prototype, flag, {\n    get: function() {\n      this.sockets.flags = this.sockets.flags || {};\n      this.sockets.flags[flag] = true;\n      return this;\n    }\n  });\n});\n\n/**\n * BC with `io.listen`\n */\n\nServer.listen = Server;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}