{"ast":null,"code":"var ThrottleGroup = require(\"stream-throttle\").ThrottleGroup;\n\nmodule.exports = throttle;\n/**\n *\n */\n\nfunction throttle(opts, listenHost) {\n  var options = {\n    local_host: listenHost,\n    remote_host: listenHost,\n    upstream: 10 * 1024,\n    downstream: opts.speed.speed * 1024,\n    keepalive: false\n  };\n  var serverOpts = {\n    allowHalfOpen: true,\n    rejectUnauthorized: false\n  };\n  var module = \"net\";\n  var method = \"createConnection\";\n\n  if (opts.key) {\n    module = \"tls\";\n    method = \"connect\";\n    serverOpts.key = opts.key;\n    serverOpts.cert = opts.cert;\n  }\n\n  return require(module).createServer(serverOpts, function (local) {\n    var remote = require(module)[method]({\n      host: opts.target.hostname,\n      port: opts.target.port,\n      allowHalfOpen: true,\n      rejectUnauthorized: false\n    });\n\n    var upThrottle = new ThrottleGroup({\n      rate: options.upstream\n    });\n    var downThrottle = new ThrottleGroup({\n      rate: options.downstream\n    });\n    var localThrottle = upThrottle.throttle();\n    var remoteThrottle = downThrottle.throttle();\n    setTimeout(function () {\n      local.pipe(localThrottle).pipe(remote);\n    }, opts.speed.latency);\n    setTimeout(function () {\n      remote.pipe(remoteThrottle).pipe(local);\n    }, opts.speed.latency);\n    local.on(\"error\", function () {\n      remote.destroy();\n      local.destroy();\n    });\n    remote.on(\"error\", function () {\n      local.destroy();\n      remote.destroy();\n    });\n  });\n}","map":{"version":3,"names":["ThrottleGroup","require","module","exports","throttle","opts","listenHost","options","local_host","remote_host","upstream","downstream","speed","keepalive","serverOpts","allowHalfOpen","rejectUnauthorized","method","key","cert","createServer","local","remote","host","target","hostname","port","upThrottle","rate","downThrottle","localThrottle","remoteThrottle","setTimeout","pipe","latency","on","destroy"],"sources":["/Users/johnberetty/node_modules/browser-sync-ui/lib/plugins/network-throttle/throttle-server.js"],"sourcesContent":["var ThrottleGroup = require(\"stream-throttle\").ThrottleGroup;\n\nmodule.exports = throttle;\n\n/**\n *\n */\nfunction throttle (opts, listenHost) {\n\n    var options = {\n        local_host:  listenHost,\n        remote_host: listenHost,\n        upstream:    10*1024,\n        downstream:  opts.speed.speed * 1024,\n        keepalive:   false\n    };\n\n    var serverOpts = {\n        allowHalfOpen: true,\n        rejectUnauthorized: false\n    };\n\n    var module = \"net\";\n    var method = \"createConnection\";\n\n    if (opts.key) {\n        module = \"tls\";\n        method = \"connect\";\n        serverOpts.key = opts.key;\n        serverOpts.cert = opts.cert;\n    }\n\n    return require(module).createServer(serverOpts, function (local) {\n\n        var remote = require(module)[method]({\n            host: opts.target.hostname,\n            port: opts.target.port,\n            allowHalfOpen: true,\n            rejectUnauthorized: false\n        });\n\n        var upThrottle = new ThrottleGroup({ rate: options.upstream });\n        var downThrottle = new ThrottleGroup({ rate: options.downstream });\n\n        var localThrottle = upThrottle.throttle();\n        var remoteThrottle = downThrottle.throttle();\n\n        setTimeout(function () {\n            local\n                .pipe(localThrottle)\n                .pipe(remote);\n        }, opts.speed.latency);\n\n        setTimeout(function () {\n            remote\n                .pipe(remoteThrottle)\n                .pipe(local);\n        }, opts.speed.latency);\n\n        local.on(\"error\", function() {\n            remote.destroy();\n            local.destroy();\n        });\n\n        remote.on(\"error\", function() {\n            local.destroy();\n            remote.destroy();\n        });\n    });\n}\n"],"mappings":"AAAA,IAAIA,aAAa,GAAGC,OAAO,CAAC,iBAAD,CAAP,CAA2BD,aAA/C;;AAEAE,MAAM,CAACC,OAAP,GAAiBC,QAAjB;AAEA;AACA;AACA;;AACA,SAASA,QAAT,CAAmBC,IAAnB,EAAyBC,UAAzB,EAAqC;EAEjC,IAAIC,OAAO,GAAG;IACVC,UAAU,EAAGF,UADH;IAEVG,WAAW,EAAEH,UAFH;IAGVI,QAAQ,EAAK,KAAG,IAHN;IAIVC,UAAU,EAAGN,IAAI,CAACO,KAAL,CAAWA,KAAX,GAAmB,IAJtB;IAKVC,SAAS,EAAI;EALH,CAAd;EAQA,IAAIC,UAAU,GAAG;IACbC,aAAa,EAAE,IADF;IAEbC,kBAAkB,EAAE;EAFP,CAAjB;EAKA,IAAId,MAAM,GAAG,KAAb;EACA,IAAIe,MAAM,GAAG,kBAAb;;EAEA,IAAIZ,IAAI,CAACa,GAAT,EAAc;IACVhB,MAAM,GAAG,KAAT;IACAe,MAAM,GAAG,SAAT;IACAH,UAAU,CAACI,GAAX,GAAiBb,IAAI,CAACa,GAAtB;IACAJ,UAAU,CAACK,IAAX,GAAkBd,IAAI,CAACc,IAAvB;EACH;;EAED,OAAOlB,OAAO,CAACC,MAAD,CAAP,CAAgBkB,YAAhB,CAA6BN,UAA7B,EAAyC,UAAUO,KAAV,EAAiB;IAE7D,IAAIC,MAAM,GAAGrB,OAAO,CAACC,MAAD,CAAP,CAAgBe,MAAhB,EAAwB;MACjCM,IAAI,EAAElB,IAAI,CAACmB,MAAL,CAAYC,QADe;MAEjCC,IAAI,EAAErB,IAAI,CAACmB,MAAL,CAAYE,IAFe;MAGjCX,aAAa,EAAE,IAHkB;MAIjCC,kBAAkB,EAAE;IAJa,CAAxB,CAAb;;IAOA,IAAIW,UAAU,GAAG,IAAI3B,aAAJ,CAAkB;MAAE4B,IAAI,EAAErB,OAAO,CAACG;IAAhB,CAAlB,CAAjB;IACA,IAAImB,YAAY,GAAG,IAAI7B,aAAJ,CAAkB;MAAE4B,IAAI,EAAErB,OAAO,CAACI;IAAhB,CAAlB,CAAnB;IAEA,IAAImB,aAAa,GAAGH,UAAU,CAACvB,QAAX,EAApB;IACA,IAAI2B,cAAc,GAAGF,YAAY,CAACzB,QAAb,EAArB;IAEA4B,UAAU,CAAC,YAAY;MACnBX,KAAK,CACAY,IADL,CACUH,aADV,EAEKG,IAFL,CAEUX,MAFV;IAGH,CAJS,EAIPjB,IAAI,CAACO,KAAL,CAAWsB,OAJJ,CAAV;IAMAF,UAAU,CAAC,YAAY;MACnBV,MAAM,CACDW,IADL,CACUF,cADV,EAEKE,IAFL,CAEUZ,KAFV;IAGH,CAJS,EAIPhB,IAAI,CAACO,KAAL,CAAWsB,OAJJ,CAAV;IAMAb,KAAK,CAACc,EAAN,CAAS,OAAT,EAAkB,YAAW;MACzBb,MAAM,CAACc,OAAP;MACAf,KAAK,CAACe,OAAN;IACH,CAHD;IAKAd,MAAM,CAACa,EAAP,CAAU,OAAV,EAAmB,YAAW;MAC1Bd,KAAK,CAACe,OAAN;MACAd,MAAM,CAACc,OAAP;IACH,CAHD;EAIH,CApCM,CAAP;AAqCH"},"metadata":{},"sourceType":"script"}