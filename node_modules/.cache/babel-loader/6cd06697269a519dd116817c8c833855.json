{"ast":null,"code":"\"use strict\";\n\nvar utils = require(\"./utils\");\n\nvar fileUtils = require(\"./file-utils\");\n\nvar Rx = require(\"rx\");\n\nvar fromEvent = Rx.Observable.fromEvent;\n\nvar fileHandler = require(\"./file-event-handler\");\n\nmodule.exports = function (bs) {\n  var events = {\n    /**\n     * File reloads\n     * @param data\n     */\n    \"file:reload\": function (data) {\n      bs.io.sockets.emit(\"file:reload\", data);\n    },\n\n    /**\n     * Browser Reloads\n     */\n    \"browser:reload\": function () {\n      bs.io.sockets.emit(\"browser:reload\");\n    },\n\n    /**\n     * Browser Notify\n     * @param data\n     */\n    \"browser:notify\": function (data) {\n      bs.io.sockets.emit(\"browser:notify\", data);\n    },\n\n    /**\n     * Things that happened after the service is running\n     * @param data\n     */\n    \"service:running\": function (data) {\n      var mode = bs.options.get(\"mode\");\n      var open = bs.options.get(\"open\");\n\n      if (mode === \"proxy\" || mode === \"server\" || open === \"ui\" || open === \"ui-external\") {\n        utils.openBrowser(data.url, bs.options, bs);\n      } // log about any file watching\n\n\n      if (bs.watchers) {\n        bs.events.emit(\"file:watching\", bs.watchers);\n      }\n    },\n\n    /**\n     * Option setting\n     * @param data\n     */\n    \"options:set\": function (data) {\n      if (bs.io) {\n        bs.io.sockets.emit(\"options:set\", data);\n      }\n    },\n\n    /**\n     * Plugin configuration setting\n     * @param data\n     */\n    \"plugins:configure\": function (data) {\n      if (data.active) {\n        bs.pluginManager.enablePlugin(data.name);\n      } else {\n        bs.pluginManager.disablePlugin(data.name);\n      }\n\n      bs.setOption(\"userPlugins\", bs.getUserPlugins());\n    },\n    \"plugins:opts\": function (data) {\n      if (bs.pluginManager.pluginOptions[data.name]) {\n        bs.pluginManager.pluginOptions[data.name] = data.opts;\n        bs.setOption(\"userPlugins\", bs.getUserPlugins());\n      }\n    }\n  };\n  Object.keys(events).forEach(function (event) {\n    bs.events.on(event, events[event]);\n  });\n  var reloader = fileHandler.applyReloadOperators(fromEvent(bs.events, \"_browser:reload\"), bs.options).subscribe(function () {\n    bs.events.emit(\"browser:reload\");\n  });\n  var coreNamespacedWatchers = fromEvent(bs.events, \"file:changed\").filter(function () {\n    return bs.options.get(\"codeSync\");\n  }).filter(function (x) {\n    return x.namespace === \"core\";\n  });\n  var handler = fileHandler.fileChanges(coreNamespacedWatchers, bs.options).subscribe(function (x) {\n    if (x.type === \"reload\") {\n      bs.events.emit(\"browser:reload\", x);\n    }\n\n    if (x.type === \"inject\") {\n      x.files.forEach(function (data) {\n        if (!bs.paused && data.namespace === \"core\") {\n          bs.events.emit(\"file:reload\", fileUtils.getFileInfo(data, bs.options));\n        }\n      });\n    }\n  });\n  bs.registerCleanupTask(function () {\n    handler.dispose();\n    reloader.dispose();\n  });\n};","map":{"version":3,"mappings":"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","names":["utils","require","fileUtils","Rx","fromEvent","Observable","fileHandler","module","exports","bs","events","data","io","sockets","emit","mode","options","get","open","openBrowser","url","watchers","active","pluginManager","enablePlugin","name","disablePlugin","setOption","getUserPlugins","pluginOptions","opts","Object","keys","forEach","event","on","reloader","applyReloadOperators","subscribe","coreNamespacedWatchers","filter","x","namespace","handler","fileChanges","type","files","paused","getFileInfo","registerCleanupTask","dispose"],"sources":["../lib/internal-events.js"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}